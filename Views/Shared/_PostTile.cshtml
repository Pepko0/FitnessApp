@using FitnessApp.Models.Enums
@using FitnessApp.Helpers
@model FitnessApp.Models.Post

@{
    var clientId = Context.Session.GetInt32("ClientId");
    var operatorId = Context.Session.GetInt32("OperatorId");

    bool lockedForGuest =
        clientId == null && operatorId == null && Model.Visibility != PostVisibility.Public;

    // link zależny od typu posta
    var url = Model.Type == PostType.Diet
        ? $"/diety/{Model.Id}"
        : $"/treningi/{Model.Id}";
}

<div class="col-12 col-md-6 col-lg-4">
    <a href="@url" class="post-tile-link">
        <div class="post-tile @(lockedForGuest ? "post-locked" : "")">

            <div class="post-header">
                <h5 class="mb-1">@Model.Title</h5>
                <div class="text-muted small">
                    @Model.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd")
                    • @Model.Operator?.FirstName @Model.Operator?.LastName
                </div>
            </div>

            <div class="post-content">
                @if (lockedForGuest)
                {
                    <span class="text-muted fst-italic">
                        Zaloguj się, aby zobaczyć szczegóły.
                    </span>
                }
                else
                {
                    @Model.Content
                }
            </div>

            @if (lockedForGuest)
            {
                <div class="post-footer-lock">
                    @Model.Visibility.GetDisplayName()
                    <i class="bi bi-lock-fill ms-1"></i>
                </div>
            }
        </div>
    </a>
</div>
